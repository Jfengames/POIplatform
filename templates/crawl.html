<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>POI爬虫平台</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/font.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/xadmin.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/bootstrap.min.css') }}">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='lib/layui/layui.js') }}" charset="utf-8"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/xadmin.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/crawl.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/layui.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/base.css') }}">
    <script type="text/javascript" src="{{ url_for('static',filename='js/city.js') }}"></script>

</head>
<body>
  <div class="x-body">
    <div>
        <iframe name="child" src="{{ url_for('static',filename='deepCoverageArcGIS.html') }}?province={{ provinceSelect }}&city={{ citySelect }}&scene={{ sceneSelect }}" width="100%" height="900px" id="arcgisHeatmap" frameborder="no" border="0"></iframe>
    </div>
    <div class="layui-col-sm3 choice">
      <div class="layui-card">
          <div class="layui-card-body">
              <form action="/crawl/" method="GET">
          <div class="form-group col-lg-15" style=" width: 100%;margin-top: 10px;height: 85px">
                    <label for="scenes"  class="col-lg-8">选择场景</label>
                    <select class="form-control col-lg-12" id="scene" name="scene">
                        {% for scene in scenes %}
                        <option value="{{scene}}" {% if scene == sceneSelect %} selected {% endif %}>{{scene}}</option>{% endfor %}
                    </select>
                </div>
                <div class="form-group col-lg-15" style=" width: 100%;margin-top: 10px;height: 85px">
                    <label for="province"  class="col-lg-8">选择省份</label>
                    <select class="form-control col-lg-12" id="province" name="province">
                        {% for a in citys %}

                            <option value="{{a}}" {% if a == provinceSelect %} selected {% endif %}>{{a}}</option>{% endfor %}
                    </select>
                </div>
                <div class="form-group col-lg-15" style=" width: 100%;margin-top: 10px;height: 85px">
                    <label for="city" class="col-lg-8" >选择城市</label>
                    <select class="form-control col-lg-12" id="city" name="city">
                        {% for b in citys[provinceSelect] %}
                            <option value="{{b}}" {% if city == citySelect %} selected {% endif %}>{{b}}</option>{% endfor %}
                    </select>
                </div>
               <button type="submit" class="btn btn-default" style="color: white;background-color: #009688">提交</button>
          <dl>
              <dd>
                  <input type="button" class="btn btn-primary btn_inoyt" style="color: white;background-color: #009688;border-color: #009688;float: right;margin-top: -37px" data-toggle="button" value="查看报表">
              </dd>
          </dl>
            </form>
        </div>
        </div>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class=flashes style="margin-top: 300px">
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
    </div>
    </div>
{% if flag %}
  <div class="layui-row layui-col-space15 div-tk" style="display: block">
{% else %}
  <div class="layui-row layui-col-space15 div-tk" style="display: none">
{% endif %}
              <div class="layui-col-sm12">
                  <div class="layui-card" id="table1">
                        <div class="layui-card-header" style="line-height: 40px;font-size: 18px;font-weight: bold;color:#009688;">
                            数据列表
                            <input type="button" class="btn btn-primary close" style="color: white;background-color: red;border-color: red;float: right;font-size: 10px" data-toggle="button" value="关闭">
                        </div>
                        <div class="layui-card-body">
                            <form action="/" method="GET">
                                <div class="table-responsive " id="table1"  style="overflow: hidden; height: 500px;">
                                    <table class="table table-striped table-sm">
                                        <thead>
                                            <tr style="background-color: #009688;color: #fff;height: 35px;">
                                            <th style="min-width: 120px;max-width: 150px;line-height: 30px;">id</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">省份</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">城市</th>
                                            <th style="min-width: 120px;max-width: 150px;line-height: 30px;">名称</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">城市代码</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">区县</th>
                                            <th style="min-width: 120px;max-width: 150px;line-height: 30px;">地址</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">经度</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">纬度</th>
                                            <th style="min-width: 120px;max-width: 150px;line-height: 30px;">大类</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">小类代码</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">小类</th>
                                            <th style="min-width: 80px;max-width: 100px;line-height: 30px;">面积</th>
                                            <th style="min-width: 200px;max-width: 250px;line-height: 30px;">形状</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for i in gaodemapscene %}
                                            <tr>
                                                <td>{{ i.id }}</td>
                                                <td>{{ i.province }}</td>
                                                <td>{{ i.city }}</td>
                                                <td>{{ i.name }}</td>
                                                <td>{{ i.city_adcode }}</td>
                                                <td>{{ i.district}}</td>
                                                <td>{{ i.address }}</td>
                                                <td>{{ i.longtitude }}</td>
                                                <td>{{ i.lat }}</td>
                                                <td>{{ i.type }}</td>
                                                <td>{{ i.typecode }}</td>
                                                <td>{{ i.classify }}</td>
                                                <td>{{ i.area }}</td>
                                                <td style="display: -webkit-box;overflow: hidden;text-overflow: ellipsis;-webkit-line-clamp: 1;height: 30px;\-webkit-box-orient: vertical;">{{ i.shape }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            <div class="page">
                <nav aria-label="Page navigation">
                    <ul class="pagination" style="margin: 10px 0;float: left;">
                        {% if paginate.has_prev %}
                            <li>
                                <a href="/crawl/?page={{ paginate.prev_num }}&city={{ citySelect }}&scene={{ sceneSelect }}&flag=1" aria-label="Previous" style="padding:0;" class="prev">
                                    <span aria-hidden="true" style="padding:0;height: 33px;width: 34px;line-height: 34px;">&lt;<</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="disabled">
                                <a href="#" aria-label="Previous" style="padding:0">
                                    <span aria-hidden="true" style="padding:0;height: 33px;width: 34px;line-height: 34px;">&lt;&lt;</span>
                                </a>
                            </li>
                        {% endif %}
                        {% for page in paginate.iter_pages() %}
                            {% if page %}
                                {% if page == paginate.page %}
                                    <li style="display:inline;" class="active"><a href=" ">{{ page }}</a></li>
                                {% else %}
                                     <li>
                                <a href="/crawl/?page={{ page }}&city={{ citySelect }}&scene={{ sceneSelect }}&flag=1" class="num">{{ page }}</a>
                            </li>
                                {% endif %}
                            {% else %}
                                <li class="disabled"><a href="#">&hellip;</a></li>
                            {% endif %}
                        {% endfor %}

                        {% if paginate.has_next %}
                            <li>
                                <a href="/crawl/?page={{ paginate.next_num }}&city={{ citySelect }}&scene={{ sceneSelect }}&flag=1" aria-label="Next" style="padding:0">
                                    <span aria-hidden="true" style="padding:0;height: 33px;width: 34px;line-height: 34px;">&gt;&gt;</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="disabled">
                                <a href="#" aria-label="Next" style="padding:0">
                                    <span aria-hidden="true" style="padding:0;height: 32px;width: 34px;line-height: 34px;">&gt;&gt;</span>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
                            </form>
                            <form action="/crawl/download/",method="GET" style="float: right;margin-top:10px;">
                                <input type="button" style="border-color: #009688;background-color: #009688" class="btn btn-primary" data-toggle="button" name="download" value="导出报表" onclick="location.href='{{ url_for('crawl.download1',city=citySelect,scene=sceneSelect)}}'">
                            </form>
                        </div>
                    </div>
              </div>
        </div>
  {% if flag %}
      <div class="mock" style="display: block"></div>
  {% else %}
      <div class="mock" style="display: none"></div>
  {% endif %}
</div>

</body>
<script>
    (function () {
       {# var pHtmlStr = '';
        for (var name in pc) {
            pHtmlStr = pHtmlStr + '<option>' + name + '</option>';
        }
        $("#province").html(pHtmlStr);#}
        $("#province").change(function () {
            var pname = $("#province option:selected").text();
            var pHtmlStr = '';
            var cityList = pc[pname];
            for (var index in cityList) {
                pHtmlStr = pHtmlStr + '<option>' + cityList[index] + '</option>';
            }
            $("#city").html(pHtmlStr);
        });
        $(".btn_inoyt").click(function(){
            $(".div-tk").css("display",'block');
            $(".mock").css("display",'block');
        });
        $(".close").click(function(){
            $(".div-tk").css("display",'none');
            $(".mock").css("display",'none');
        });
        $(".num").click(function(){
            $(".div-tk").css("display",'block');
            $(".mock").css("display",'block');
        });
        {#$("#province").change();#}
    })();
</script>


{#<script>#}
{#$(function(){#}
{#    $("li a").click(function(event) {#}
{#        // 获取这个a标签的href中的url#}
{#        url = $(this).attr("href");#}
{#        var city = $('#city').val()#}
{#        var scene = $('#scene').val()#}
{#        var data= {#}
{#                data: JSON.stringify({#}
{#                    'city': city,#}
{#                    'scene': scene#}
{#                }),#}
{#            }#}
        {#console.log(url)#}
        {#// 取消点击事件的默认动作#}
{#        event.preventDefault();#}
        {#// 修改form中的action动作#}
        {#$("form").attr("action", url);#}
        {##}
        {#// 提交表单#}
        {#$("form").submit();#}
{#        $.ajax({#}
{#            url:url,#}
{#            type:"post",#}
{#            data:data,#}
{#            success:function(data){#}
{#                console.log(data)#}
{#            }#}
{##}
{#        })#}
{#    });#}
{#});#}
{#</script>#}

{#<script>#}
{#    $(function () {#}
{#        $(".dropdown-toggle").dropdown('toggle');#}
{#    });#}
{#</script>#}
</html>



